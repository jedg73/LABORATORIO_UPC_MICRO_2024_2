#include <stdlib.h>
#include <stdio.h>
#include <pic18f57q43.h>
#include <xc.h>
#include "cabzon.h"

#define _XTAL_FREQ 4000000UL

void configuro();
void __interrupt() INT_EXT_INT0();

void main(void)
{
    configuro();
    while (1)
    {
        LATAbits.LATA0 = 1;
        __delay_ms(125);
        LATAbits.LATA0 = 0;
        __delay_ms(125);
    }
}

void configuro()
{
    OSCCON1 = 0x60;   // HFINTOSC seleccionado
    OSCFRQ = 0x02;    // HFINTOSC a 4MHz
    OSCEN = 0x40;     // HFINTOSC habilitado
    TRISAbits.TRISA0 = 0;  // RA0: salida
    ANSELAbits.ANSELA0 = 0; // RA0: digital
    LATAbits.LATA0 = 0;     // RA0: apagado
    TRISB = 0xFF;           // RB: entradas
    ANSELB = 0x00;          // RB: digital
    TRISD = 0x00;           // RD: salidas
    ANSELD = 0x00;          // RD: digital
    LATD = 0x00;            // RD: apagado
    WPUBbits.WPUB0 = 1;     // Pull-UP para RB0
    INTCON0bits.GIE = 1;    // Habilitador Global de Interrupciones
    INTCON0bits.INT0EDG = 0; // Flanco de bajada
    PIE1bits.INT0IE = 1;    // Habilitador de interrupci√≥n para INT0
}

void __interrupt() INT_EXT_INT0()
{
    if (PIR1bits.INT0IF == 1)
    {
        for (int i = 0; i < 5; i++)
        {
            LATDbits.LATD0 = 1;
            __delay_ms(200);
            LATDbits.LATD0 = 0;
            __delay_ms(200);
        }
        PIR1bits.INT0IF = 0;
    }
}
